<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="color-scheme" content="light dark">

    

    <meta name="author" content="Daniel Parrales">
    <meta name="description" content="Implantación de aplicaciones web PHP">
    <meta name="keywords" content="blog,developer,personal,">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Implantación de aplicaciones web PHP"/>
<meta name="twitter:description" content="Implantación de aplicaciones web PHP"/>

    <meta property="og:title" content="Implantación de aplicaciones web PHP" />
<meta property="og:description" content="Implantación de aplicaciones web PHP" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://www.sysadblog.com/posts/practicacms/" />
<meta property="article:published_time" content="2021-10-28T11:07:36+02:00" />
<meta property="article:modified_time" content="2021-10-28T11:07:36+02:00" />


    <title>
  Implantación de aplicaciones web PHP · Sysadblog
</title>

    
      <link rel="canonical" href="http://www.sysadblog.com/posts/practicacms/">
    

    <link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>

    
      
      
      <link rel="stylesheet" href="/css/coder.min.8e2b2510f60e1715eae08d113a808dcdaf17f6f711edb9e969be38d0074d240d.css" integrity="sha256-jislEPYOFxXq4I0ROoCNza8X9vcR7bnpab440AdNJA0=" crossorigin="anonymous" media="screen" />
    

    

    
      
        
        
        <link rel="stylesheet" href="/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css" integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin="anonymous" media="screen" />
      
    

    

    

    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

    

    <meta name="generator" content="Hugo 0.80.0" />
  </head>

  
  
    
  
  <body class="preload-transitions colorscheme-auto"
        onload=""
  >
    
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      Sysadblog
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blog</a>
            </li>
          
            <li class="navigation-item">
              <a class="navigation-link" href="/aboutme">About</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="http://www.sysadblog.com/posts/practicacms/">
              Implantación de aplicaciones web PHP
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime='2021-10-28T11:07:36&#43;02:00'>
                October 28, 2021
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              13-minute read
            </span>
          </div>
          <div class="authors">
    <i class="fa fa-user" aria-hidden="true"></i>
      <a href="/authors/daniel-parrales/">Daniel Parrales</a></div>
          
          
        </div>
      </header>

      <div>
        
        <h1 id="práctica-implantación-de-aplicaciones-web-php">
  Práctica: Implantación de aplicaciones web PHP
  <a class="heading-link" href="#pr%c3%a1ctica-implantaci%c3%b3n-de-aplicaciones-web-php">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h1>
<p>Los requisitos previos son los siguientes:</p>
<ul>
<li>Crea una instancia de vagrant basado en un box debian o ubuntu</li>
<li>Instala en esa máquina virtual toda la pila LAMP</li>
</ul>
<h2 id="tarea-1-instalación-de-un-cms-php-en-mi-servidor-local">
  Tarea 1: Instalación de un CMS PHP en mi servidor local
  <a class="heading-link" href="#tarea-1-instalaci%c3%b3n-de-un-cms-php-en-mi-servidor-local">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Los objetivos de esta tarea son los siguientes:</p>
<ul>
<li>Configura el servidor web con virtual hosting para que el CMS sea accesible desde la dirección: <code>www.nombrealumno-nombrecms.org</code>.</li>
<li>Crea un usuario en la base de datos para trabajar con la base de datos donde se van a guardar los datos del CMS.</li>
<li>Descarga el CMS seleccionado y realiza la instalación.</li>
<li>Realiza una configuración mínima de la aplicación (Cambia la plantilla, crea algún contenido, …)</li>
<li>Instala un módulo para añadir alguna funcionalidad al CMS.</li>
</ul>
<h3 id="configura-el-servidor-web-con-virtual-hosting-para-que-el-cms-sea-accesible-desde-la-dirección-wwwnombrealumno-nombrecmsorg">
  Configura el servidor web con virtual hosting para que el CMS sea accesible desde la dirección: <code>www.nombrealumno-nombrecms.org</code>
  <a class="heading-link" href="#configura-el-servidor-web-con-virtual-hosting-para-que-el-cms-sea-accesible-desde-la-direcci%c3%b3n-wwwnombrealumno-nombrecmsorg">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Vamos a crear el fichero de configuración del virtualhost en el directorio <code>/etc/apache2/sites-available</code>, y lo vamos a llamar <em>dparrales-mediawiki.conf</em>. La configuración del virtualhost es la siguiente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    ServerName www.dparrales-mediawiki.com
    ServerAlias www.dparrales-mediawiki.com
    DocumentRoot /var/www/www.dparrales-mediawiki.com
    ErrorLog ${APACHE_LOG_DIR}/error-mediawiki.log
    CustomLog ${APACHE_LOG_DIR}/access-media-wiki.log combined

    &lt;Directory /var/www/www.dparrales-mediawiki.com&gt;
          Options -Indexes
    &lt;/Directory&gt;

    &lt;IfModule mod_dir.c&gt;
        DirectoryIndex index.php index.html index.cgi index.pl  index.xhtml index.htm
    &lt;/IfModule&gt;

&lt;/VirtualHost&gt;
</code></pre></div><p>Ahora habilitamos el virtualhost con el siguiente comando:</p>
<p><code>a2ensite dparrales-mediawiki.conf</code></p>
<p>También hay que crear la carpeta y un archivo de prueba en el DocumentRoot:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">tree /var/www/www.dparrales-mediawiki.com/
/var/www/www.dparrales-mediawiki.com/
└── info.php

0 directories, 1 file
</code></pre></div><p>Reiniciamos el servicio para aplicar los cambios que hemos hecho:</p>
<p><code>systemctl reload apache2</code></p>
<p>Ya solo tenemos que añadir la línea de resolución de nombres al fichero <em>/etc/hosts</em> del anfitrión:</p>
<p><code>192.168.121.241 www.dparrales-mediawiki.com</code></p>
<p>Con esto, ya podemos acceder a través de nuestro navegador y ver si se nos muestra la pantalla de información sobre <em>php</em> que tenemos en el servidor:</p>
<p><img src="/images/practicacms/conexion_primera.png" alt="conexion_primera.png"></p>
<h3 id="crea-un-usuario-en-la-base-de-datos-para-trabajar-con-la-base-de-datos-donde-se-van-a-guardar-los-datos-del-cms">
  Crea un usuario en la base de datos para trabajar con la base de datos donde se van a guardar los datos del CMS.
  <a class="heading-link" href="#crea-un-usuario-en-la-base-de-datos-para-trabajar-con-la-base-de-datos-donde-se-van-a-guardar-los-datos-del-cms">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Antes con continuar con la instalación, debemos crear una base de datos en mariadb y un usuario con permisos sobre esa base de datos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">mysql -u root -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 6
Server version: 10.5.12-MariaDB-0+deb11u1 Debian 11

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

MariaDB [(none)]&gt; create database mediawiki
    -&gt; ;
Query OK, 1 row affected (0.007 sec)

MariaDB [(none)]&gt; grant all on mediawiki.* to &#39;mediawiki&#39;@&#39;%&#39; identified by &#39;******&#39; with grant option;
Query OK, 0 rows affected (0.010 sec)
</code></pre></div><h3 id="descarga-el-cms-seleccionado-y-realiza-la-instalación">
  Descarga el CMS seleccionado y realiza la instalación.
  <a class="heading-link" href="#descarga-el-cms-seleccionado-y-realiza-la-instalaci%c3%b3n">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Ahora podemos descargar los archivos de configuración y descomprimir el cms en el DocumentRoot:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">wget https://releases.wikimedia.org/mediawiki/1.36/mediawiki-1.36.2.tar.gz

tar -vxf mediawiki-1.36.2.tar.gz
</code></pre></div><p>Ya podemos configurar el cms si accedemos desde el navegador a la ruta donde se encuentra el fichero de configuración:</p>
<p><img src="/images/practicacms/configuracion_mediawiki1.png" alt="configuracion_mediawiki1.png"></p>
<p>Como podemos ver, se nos pide que instalemos unos paquetes antes de realizar la configuración:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">apt install php-mbstring php-xml php-intl

systemctl reload apache2
</code></pre></div><p>Ahora al acceder a la misma url nos sale el menú de configuración:</p>
<p><img src="/images/practicacms/configuracion_mediawiki2.png" alt="configuracion_mediawiki2.png"></p>
<p>Ya podemos iniciar la configuración de mediawiki. Tras rellenar todos los campos en las páginas de configuración con los datos del usuario y de la base de datos que creamos antes, llegamos al final de la instalación:</p>
<p><img src="/images/practicacms/finalizarmediawiki.png" alt="finalizarmediawiki.png"></p>
<p>Haciendo caso a lo que nos dice la página y copiamos el archivo que se ha descargado (<em>LocalSettings.php</em>) en el directorio donde se encontraba el <em>index.php</em> (<em><code>www.dparrales-mediawiki.com/mediawiki-1.36.2/mw-config</code></em>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ls -l

total 1636
-rw-rw-r--  1 www-data www-data     168 Sep 30 16:46 CODE_OF_CONDUCT.md
-rw-rw-r--  1 www-data www-data   19421 Nov  4  2019 COPYING
-rw-rw-r--  1 www-data www-data   13612 Sep 30 16:48 CREDITS
-rw-rw-r--  1 www-data www-data      95 Nov  4  2019 FAQ
-rw-rw-r--  1 www-data www-data 1247893 Sep 30 16:48 HISTORY
-rw-rw-r--  1 www-data www-data    3612 Sep 30 16:48 INSTALL
-rw-r--r--  1 www-data www-data    4634 Oct 21 07:13 LocalSettings.php
-rw-rw-r--  1 www-data www-data    1525 Sep 30 16:46 README.md
-rw-rw-r--  1 www-data www-data   48038 Sep 30 16:48 RELEASE-NOTES-1.36
-rw-rw-r--  1 www-data www-data     199 Nov  4  2019 SECURITY
-rw-rw-r--  1 www-data www-data    4544 Sep 30 16:48 UPGRADE
-rw-rw-r--  1 www-data www-data    4490 Sep 30 16:46 api.php
-rw-rw-r--  1 www-data www-data  156893 Sep 30 16:48 autoload.php
drwxr-xr-x  2 www-data www-data    4096 Oct 20 12:33 cache
-rw-rw-r--  1 www-data www-data    5073 Sep 30 16:48 composer.json
-rw-rw-r--  1 www-data www-data     102 Nov  4  2019 composer.local.json-sample
drwxr-xr-x  5 www-data www-data    4096 Oct 20 12:33 docs
drwxr-xr-x 30 www-data www-data    4096 Oct 20 12:33 extensions
drwxr-xr-x  2 www-data www-data    4096 Oct 21 06:59 images
-rw-rw-r--  1 www-data www-data    8245 Sep 30 16:46 img_auth.php
drwxr-xr-x 83 www-data www-data    4096 Oct 20 12:33 includes
-rw-rw-r--  1 www-data www-data    1977 Sep 30 16:46 index.php
-rw-rw-r--  1 www-data www-data    1430 Sep 30 16:48 jsduck.json
drwxr-xr-x  6 www-data www-data    4096 Oct 20 12:33 languages
-rw-rw-r--  1 www-data www-data    1951 Sep 30 16:46 load.php
drwxr-xr-x 15 www-data www-data   12288 Oct 20 12:33 maintenance
drwxr-xr-x  4 www-data www-data    4096 Oct 21 07:20 mw-config
-rw-rw-r--  1 www-data www-data    4610 Sep 30 16:46 opensearch_desc.php
drwxr-xr-x  5 www-data www-data    4096 Oct 20 12:33 resources
-rw-rw-r--  1 www-data www-data     998 Sep 30 16:46 rest.php
drwxr-xr-x  5 www-data www-data    4096 Oct 20 12:33 skins
drwxr-xr-x  9 www-data www-data    4096 Oct 20 12:33 tests
-rw-rw-r--  1 www-data www-data   23581 Sep 30 16:48 thumb.php
-rw-rw-r--  1 www-data www-data    1439 Sep 30 16:46 thumb_handler.php
drwxr-xr-x 17 www-data www-data    4096 Oct 20 12:33 vendor
</code></pre></div><p>Ahora ya podemos acceder a la página principal al entrar en la ruta donde hemos guardado el fichero <em>LocalSettings.php</em>:</p>
<p><img src="/images/practicacms/paginaprincipal_mediawiki.png" alt="paginaprincipal_mediawiki.png"></p>
<h3 id="realiza-una-configuración-mínima-de-la-aplicación-cambia-la-plantilla-crea-algún-contenido-">
  Realiza una configuración mínima de la aplicación (Cambia la plantilla, crea algún contenido, …)
  <a class="heading-link" href="#realiza-una-configuraci%c3%b3n-m%c3%adnima-de-la-aplicaci%c3%b3n-cambia-la-plantilla-crea-alg%c3%ban-contenido-">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>Para este paso he creado un nuevo post en la página de mediawiki sobre mi usuario: <em>mediawiki</em>:</p>
<p><img src="/images/practicacms/primerpost.png" alt="primerpost.png"></p>
<h3 id="instala-un-módulo-para-añadir-alguna-funcionalidad-al-cms">
  Instala un módulo para añadir alguna funcionalidad al CMS.
  <a class="heading-link" href="#instala-un-m%c3%b3dulo-para-a%c3%b1adir-alguna-funcionalidad-al-cms">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h3>
<p>En mi caso, voy a instalar una extensión que nos permitirá tener un calendario en la página de la wiki. Para ello descargamos primero la extensión:</p>
<p><code>wget https://extdist.wmflabs.org/dist/extensions/SimpleCalendar-master-dc0b4a4.tar.gz</code></p>
<p>A continuación, descomprimimos el archivo en la carpeta <code>/extensions</code> de mediawiki:</p>
<p><code>tar -xzf SimpleCalendar-master-dc0b4a4.tar.gz -C /var/www/www.dparrales-mediawiki.com/mediawiki-1.36.2/extensions/</code></p>
<p>Ya solo tenemos que añadir la siguiente línea al final del fichero <em>LocalSettings.php</em> y reiniciar el servicio:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">wfLoadExtension( &#39;SimpleCalendar&#39; );

systemctl reload apache2
</code></pre></div><p>Con esto ya debería aparecernos la nueva extensión en la lista de extensiones instaladas:</p>
<p><img src="/images/practicacms/extensioninstalada.png" alt="extensioninstalada.png"></p>
<h2 id="tarea-2-configuración-multinodo">
  Tarea 2: Configuración multinodo
  <a class="heading-link" href="#tarea-2-configuraci%c3%b3n-multinodo">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Los objetivos de esta tarea son los siguientes:</p>
<ul>
<li>Realiza un copia de seguridad de la base de datos</li>
<li>Crea otra máquina con vagrant, conectada con una red interna a la anterior y configura un servidor de base de datos.</li>
<li>Crea un usuario en la base de datos para trabajar con la nueva base de datos.</li>
<li>Restaura la copia de seguridad en el nuevo servidor de base datos.</li>
<li>Desinstala el servidor de base de datos en el servidor principal.</li>
<li>Realiza los cambios de configuración necesario en el CMS para que la página funcione.</li>
</ul>
<hr>
<h2 id="realiza-un-copia-de-seguridad-de-la-base-de-datos">
  Realiza un copia de seguridad de la base de datos
  <a class="heading-link" href="#realiza-un-copia-de-seguridad-de-la-base-de-datos">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Para realizar la copia de seguridad basta con utilizar el siguiente comando, lo que nos generará un fichero sql con la información de la base de datos que le indiquemos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">mysqldump -v --opt --events --routines --triggers --default-character-set=utf8 -u mediawiki -p mediawiki &gt; db_backup_mediawiki_`date +%Y%m%d_%H%M%S`.sql
</code></pre></div><p>Este fichero <code>.sql</code> podemos comprimirlo después para que sea más manejable, pero como esta base de datos es nueva y apenas tiene contenido, no he visto necesario comprimirlo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ls -lh

-rw-r--r-- 1 vagrant vagrant 2.4M Oct 26 06:36 db_backup_mediawiki_20211026_063630.sql
</code></pre></div><h2 id="crea-otra-máquina-con-vagrant-conectada-con-una-red-interna-a-la-anterior-y-configura-un-servidor-de-base-de-datos">
  Crea otra máquina con vagrant, conectada con una red interna a la anterior y configura un servidor de base de datos.
  <a class="heading-link" href="#crea-otra-m%c3%a1quina-con-vagrant-conectada-con-una-red-interna-a-la-anterior-y-configura-un-servidor-de-base-de-datos">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Para ello vamos a utilizar la misma configuración de vagrant que con el anterior, por lo que su creación será bastante rápida. A continuación el <code>Vagrantfile</code> que he usado:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">Vagrant.configure(&#34;2&#34;) do |config|
      config.vm.provider :libvirt do |v|
      v.memory = 1024
      end
    config.vm.define :nodo1 do |nodo1|
      nodo1.vm.box = &#34;debian/bullseye64&#34;
      nodo1.vm.hostname = &#34;CMS1&#34;
      nodo1.vm.synced_folder &#34;.&#34;, &#34;/vagrant&#34;, disabled: true
      nodo1.vm.network :private_network,
         :libvirt__network_name =&gt; &#34;muyaislada&#34;,
         :libvirt__dhcp_enabled =&gt; false,
         :ip =&gt; &#34;10.0.0.2&#34;,
         :libvirt__forward_mode =&gt; &#34;veryisolated&#34;
     end
    config.vm.define :nodo2 do |nodo2|
      nodo2.vm.synced_folder &#34;.&#34;, &#34;/vagrant&#34;, disabled: true
      nodo2.vm.box = &#34;debian/bullseye64&#34;
      nodo2.vm.hostname = &#34;CMS2&#34;
      nodo2.vm.network :private_network,
         :libvirt__network_name =&gt; &#34;muyaislada&#34;,
         :libvirt__dhcp_enabled =&gt; false,
         :ip =&gt; &#34;10.0.0.3&#34;,
         :libvirt__forward_mode =&gt; &#34;veryisolated&#34;
     end
end
</code></pre></div><p>A continuación instalamos, securizamos la base de datos mariadb y la configuramos para que pueda ser accedida desde el exterior:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">apt-get install mariadb-server

mysql_secure_installation
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">nano /etc/mysql/mariadb.conf.d/50-server.cnf

bind-address            = 0.0.0.0
</code></pre></div><p>Reiniciamos el servicio para que cargue la nueva configuración:</p>
<p><code>systemctl restart mariadb</code></p>
<h2 id="crea-un-usuario-en-la-base-de-datos-para-trabajar-con-la-nueva-base-de-datos">
  Crea un usuario en la base de datos para trabajar con la nueva base de datos.
  <a class="heading-link" href="#crea-un-usuario-en-la-base-de-datos-para-trabajar-con-la-nueva-base-de-datos">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Entramos como root y creamos el nuevo usuario. Para facilitarnos el trabajo, hemos creado el mismo usuario que en la anterior base de datos:</p>
<p><code>create user 'mediawiki'@'%' identified by '******';</code></p>
<h2 id="restaura-la-copia-de-seguridad-en-el-nuevo-servidor-de-base-datos">
  Restaura la copia de seguridad en el nuevo servidor de base datos.
  <a class="heading-link" href="#restaura-la-copia-de-seguridad-en-el-nuevo-servidor-de-base-datos">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Para ello hemos de llevar el fichero <code>.sql</code> de la forma que queramos desde una máquina a otra, y una vez allí usamos el siguiente comando para restaurar la copia de seguridad:</p>
<p><code>mysql -u mediawiki -p mediawiki &lt; db_backup_mediawiki_20211026_063630.sql</code></p>
<p><em>Nota</em>: Antes hemos de haber creado la base de datos a la que hacemos referencia en el comando (mediawiki) y haber otorgado permisos al usuario sobre esa base de datos.</p>
<h2 id="desinstala-el-servidor-de-base-de-datos-en-el-servidor-principal">
  Desinstala el servidor de base de datos en el servidor principal.
  <a class="heading-link" href="#desinstala-el-servidor-de-base-de-datos-en-el-servidor-principal">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Para ello simplemente usamos el siguiente comando:</p>
<p><code>apt remove mariadb-server</code></p>
<h2 id="realiza-los-cambios-de-configuración-necesario-en-el-cms-para-que-la-página-funcione">
  Realiza los cambios de configuración necesario en el CMS para que la página funcione.
  <a class="heading-link" href="#realiza-los-cambios-de-configuraci%c3%b3n-necesario-en-el-cms-para-que-la-p%c3%a1gina-funcione">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Cambiar la configuración de mediawiki para que utilice otro servidor es bastante sencilla. Para ello tenemos que modificar el fichero <em>LocalSettings.php</em>. Las líneas que debemos cambiar son las siguientes:</p>
<p><img src="/images/practicacms/configuracion_mediawiki_dbexterna.png" alt="configuracion_mediawiki_dbexterna.png"></p>
<h2 id="tarea-3-instalación-de-otro-cms-php">
  Tarea 3: Instalación de otro CMS PHP
  <a class="heading-link" href="#tarea-3-instalaci%c3%b3n-de-otro-cms-php">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Los objetivos de esta tarea son los siguientes:</p>
<ul>
<li>Elige otro CMS realizado en PHP y realiza la instalación en tu infraestructura.</li>
<li>Configura otro virtualhost para acceder con otro nombre: <code>www.nombrealumno-nombrecms.org</code>.</li>
</ul>
<hr>
<h2 id="elige-otro-cms-realizado-en-php-y-realiza-la-instalación-en-tu-infraestructura-con-otro-virtualhost">
  Elige otro CMS realizado en PHP y realiza la instalación en tu infraestructura (con otro virtualhost).
  <a class="heading-link" href="#elige-otro-cms-realizado-en-php-y-realiza-la-instalaci%c3%b3n-en-tu-infraestructura-con-otro-virtualhost">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>He elegido el cms OpenCart, un sistema de administración online, que utiliza PHP y una base de datos Mysql. Los primeros pasos serán similares a los anteriores:</p>
<ul>
<li>Creamos un nuevo virtualhost para OpenCart:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    ServerName www.dparrales-opencart.org
    ServerAlias www.dparrales-opencart.org
    DocumentRoot /var/www/opencart
    ErrorLog ${APACHE_LOG_DIR}/error-opencart.log
    CustomLog ${APACHE_LOG_DIR}/access-opencart.log combined

    &lt;Directory /var/www/opencart&gt;
          Options -Indexes
    &lt;/Directory&gt;

    &lt;IfModule mod_dir.c&gt;
        DirectoryIndex index.php index.html index.cgi index.pl  index.xhtml index.htm
    &lt;/IfModule&gt;

&lt;/VirtualHost&gt;
</code></pre></div><ul>
<li>Habilitamos el virtualhost y reiniciamos el servicio:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">a2ensite dparrales-opencart.conf 

systemctl reload apache2
</code></pre></div><ul>
<li>Descargamos y extraemos el archivo de instalación de opencart en el DocumentRoot:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ls -l /var/www/opencart/
total 17296
-rw-r--r-- 1 root    root       33574 Aug 27 07:28 CHANGELOG.md
-rw-r--r-- 1 root    root      327817 Aug 27 07:28 CHANGELOG_AUTO.md
-rw-r--r-- 1 root    root        5021 Aug 27 07:28 README.md
-rw-r--r-- 1 root    root        2106 Aug 27 07:28 build.xml
-rw-r--r-- 1 root    root         622 Aug 27 07:28 composer.json
-rw-r--r-- 1 root    root       36033 Aug 27 07:28 composer.lock
-rw-r--r-- 1 root    root        3709 Aug 27 07:28 install.txt
-rw-r--r-- 1 root    root       34529 Aug 27 07:28 license.txt
-rw-r--r-- 1 vagrant vagrant 17233835 Oct 27 12:20 opencart-3.0.3.8.zip
-rw-r--r-- 1 root    root        5995 Aug 27 07:28 upgrade.txt
drwxr-xr-x 7 root    root        4096 Aug 27 07:28 upload
</code></pre></div><ul>
<li>Antes de seguir con la instalación, creamos la base de datos y un nuevo usuario para administrar dicha base de datos:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">mysql -u root -p
Enter password: 
Welcome to the MariaDB monitor.  Commands end with ; or \g.
Your MariaDB connection id is 6
Server version: 10.5.12-MariaDB-0+deb11u1 Debian 11

Copyright (c) 2000, 2018, Oracle, MariaDB Corporation Ab and others.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

MariaDB [(none)]&gt; create database opencart;
Query OK, 1 row affected (0.007 sec)

MariaDB [(none)]&gt; grant all on opencart.* to &#39;opencart&#39;@&#39;%&#39; identified by &#39;******&#39; with gra
nt option;
Query OK, 0 rows affected (0.015 sec)
</code></pre></div><ul>
<li>Leemos las instrucciones para instalar <em>opencart</em>:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">- Linux Install -

1. Upload all of the files and folders to your server from the &#34;Upload&#34; folder, place them in your web root. The web root is different on some servers, cPanel it should be public_html/ and on Plesk it should be httpdocs/.

2. Rename config-dist.php to config.php and admin/config-dist.php to admin/config.php

3. For Linux/Unix make sure the following folders and files are writable.

        chmod 0755 system/storage/cache/
        chmod 0755 system/storage/download/
        chmod 0755 system/storage/logs/
        chmod 0755 system/storage/modification/
        chmod 0755 system/storage/session/
        chmod 0755 system/storage/upload/
        chmod 0755 system/storage/vendor/
        chmod 0755 image/
        chmod 0755 image/cache/
        chmod 0755 image/catalog/
        chmod 0755 config.php
        chmod 0755 admin/config.php

        If 0755 does not work try 0777.

4. Make sure you have installed a MySQL Database which has a user assigned to it
    DO NOT USE YOUR ROOT USERNAME AND ROOT PASSWORD

5. Visit the store homepage e.g. http://www.example.com or http://www.example.com/store/

6. You should be taken to the installer page. Follow the on screen instructions.

7. After successful install, delete the /install/ directory from ftp.

8. If you have downloaded the compiled version with a folder called &#34;vendor&#34; - this should be uploaded above the webroot (so the same folder where the public_html or httpdocs is)
</code></pre></div><ul>
<li>Seguimos lo que se nos indica:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">mv config-dist.php config.php
mv admin/config-dist.php admin/config.php
chmod 0755 system/storage/cache/
chmod 0755 system/storage/download/
chmod 0755 system/storage/logs/
chmod 0755 system/storage/modification/
chmod 0755 system/storage/session/
chmod 0755 system/storage/upload/
chmod 0755 system/storage/vendor/
chmod 0755 image/
chmod 0755 image/cache/
chmod 0755 image/catalog/
chmod 0755 config.php
chmod 0755 admin/config.php
mv upload/* .
</code></pre></div><ul>
<li>Nos quedan los siguientes ficheros y directorios en el DocumentRoot:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">ls -l /var/www/opencart/
total 32
drwxr-xr-x 6 www-data www-data 4096 Oct 27 15:32 admin
drwxr-xr-x 6 www-data www-data 4096 Aug 27 07:28 catalog
-rwxr-xr-x 1 www-data www-data    0 Aug 27 07:28 config.php
drwxr-xr-x 5 www-data www-data 4096 Aug 27 07:28 image
-rw-r--r-- 1 www-data www-data  293 Aug 27 07:28 index.php
drwxr-xr-x 6 www-data www-data 4096 Aug 27 07:28 install
-rw-r--r-- 1 www-data www-data  418 Aug 27 07:28 php.ini
-rw-r--r-- 1 www-data www-data  345 Aug 27 07:28 robots.txt
drwxr-xr-x 7 www-data www-data 4096 Aug 27 07:28 system
</code></pre></div><ul>
<li>Ahora accedemos a nuestro virtualhost a través del navegador para continuar con la instalación (previamente añadiendo la resolución de nombres al fichero <code>/etc/hosts</code>):</li>
</ul>
<p><img src="/images/practicacms/instalar_opencart.png" alt="instalar_opencart.png"></p>
<ul>
<li>Nos aseguramos de tener instaladas todas las dependencias y de que los directorios que nos indica tienen los permisos correctos:</li>
</ul>
<p><img src="/images/practicacms/requisitos_opencart.png" alt="requisitos_opencart.png"></p>
<p><img src="/images/practicacms/requisitos_opencart2.png" alt="requisitos_opencart2.png"></p>
<ul>
<li>Rellenamos con la información de nuestra base de datos:</li>
</ul>
<p><img src="/images/practicacms/basedatos_opencart.png" alt="basedatos_opencart.png"></p>
<ul>
<li>Con esto hemos terminado de instalar opencart:</li>
</ul>
<p><img src="/images/practicacms/finalizar_opencart.png" alt="finalizar_opencart.png"></p>
<p>Ya podemos acceder a nuestra página:</p>
<p><img src="/images/practicacms/opencart.png" alt="opencart.png"></p>
<h2 id="tarea-4-migración-del-cms-php-en-el-hosting-compartido">
  Tarea 4: Migración del CMS PHP en el hosting compartido.
  <a class="heading-link" href="#tarea-4-migraci%c3%b3n-del-cms-php-en-el-hosting-compartido">
    <i class="fa fa-link" aria-hidden="true"></i>
  </a>
</h2>
<p>Vamos a migrar la última aplicación que has instalado a un hosting externo, para ello sigue los siguientes pasos:</p>
<ul>
<li>Elige un servicio de hosting compartido con las características necesarias para instalar un CMS PHP (soporte PHP, base de datos,…)</li>
<li>Date de alta en el servicio.</li>
<li>Realiza la migración: Sube los ficheros al hosting externo, cambia las credenciales de acceso a la base de datos,…</li>
</ul>
<hr>
<p>En mi caso, he elegido el hosting <em>awardspacenet</em>, ya que tenía una cuenta creada en este hosting por otro ejercicio anterior, y tras informarme, cumplía los requisitos que pedía el ejercicio.</p>
<p>Una vez creada la cuenta, elegimos el nombre para nuestro subdominio gratuito. En mi caso he elegdo <code>http://dparrales-opencart.atwebpages.com</code>. Una vez creado el subdominio, vemos que nos ha creado una carpeta en nuestro directorio raíz con el mismo nombre, que es donde subiremos nuestros archivos:</p>
<p><img src="/images/practicacms/opencart_hosting.png" alt="opencart_hosting.png"></p>
<p>Ahora toca subir nuestros archivos al hosting. Yo he utilizado filezilla y he seguido los pasos que me indicaba la página para subir todos los ficheros al hosting:</p>
<p><img src="/images/practicacms/filezilla.png" alt="filezilla.png"></p>
<p>Cuando se hayan subido los archivos (tarda su tiempo), es hora de subir la información de nuestra base de datos al hosting. Para ello seguiremos los pasos del ejercicio 2 para sacar una copia de la información de la base de datos, y la subiremos con el cliente de <code>phpmyadmin</code> que nos ofrece nuestro hosting:</p>
<p><img src="/images/practicacms/phpmyadmin.png" alt="phpmyadmin.png"></p>
<p>Acabado este paso, ya solo tenemos que cambiar el fichero de configuración de nuestro cms (en mi caso llamado <code>config.php</code>) y cambiar la rutas de los directorios que nos indica y las credenciales de acceso a la base de datos:</p>
<p><img src="/images/practicacms/configuracion_opencart_hosting.png" alt="configuracion_opencart_hosting.png"></p>
<p>Guardamos el archivo e intentamos acceder a la nueva ruta desde el navegador:</p>
<p><img src="/images/practicacms/opencart_hosting_acceso.png" alt="opencart_hosting_acceso.png"></p>
<p>Accedemos con las credenciales que usamos en la instalación de opencart, y si funciona la conexión con la base de datos, debería dejarnos entrar:</p>
<p><img src="/images/practicacms/final_opencart.png" alt="final_opencart.png"></p>
<p>Con esto hemos finalizado el ejercicio con éxito.</p>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p>El camino a la locura de un sysadmin</p>
      
      
        ©
        
        2021
         Daniel Parrales 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
    </section>
  </footer>


    </main>

    
      
      <script src="/js/coder.min.a350362441276ec5c1671926420497bb8e52b63ead1d51d3c9bc4342d0039526.js" integrity="sha256-o1A2JEEnbsXBZxkmQgSXu45Stj6tHVHTybxDQtADlSY="></script>
    

    

    

    

    

    

    

    

    
  </body>

</html>
